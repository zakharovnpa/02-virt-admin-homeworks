# "5.5. Оркестрация кластером Docker контейнеров на примере Docker Swarm" - Захаров Сергей Николаевич

## Задача 1

Дайте письменые ответы на следующие вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?
- Какой алгоритм выбора лидера используется в Docker Swarm кластере? Смотрите слайд с Полезными материалами.
- Что такое Overlay Network?

**Ответ:**
1. Есть два типа выполнения сервисов:
  - Replicated. Он находится в стольких экземплярах, сколько мы задаем
  - Global. В этом режиме сервисы запускаются на всех нодах одновременно. Обычно режим Global используется для различных экспортеров, чтобы обеспечить мониторинг всего кластера. Также для всех сущностей, которые нужно чтобы они в моменте находились на каждой ноде, неважно Worker это или Manager. Самый типичный прмиер режима выполнения сервиса Global - это экспортеры для передачи метрик на сервер мониторинга.
2. Raft - это алгоритм управления реплицированным журналом в форме, описанной в разделе 2. На рисунке 2 приведен алгоритм в сжатой форме для справки, а на рисунке 3 
перечислены ключевые свойства алгоритма; элементы этих фигур обсуждаются по частям в остальной части этого раздела. Raft реализует консенсус, сначала выбирая 
выдающегося лидера, а затем возлагая на него полную ответственность за управление реплицированным журналом. Лидер принимает записи журнала от клиентов, 
реплицирует их на другие серверы и сообщает серверам, когда можно безопасно применять записи журнала к их конечным машинам. Наличие лидера упрощает управление 
реплицированным журналом. Например, лидер может решить, где разместить новые записи в журнале, не консультируясь с другими серверами, и данные будут передаваться 
простым способом от лидера к другим серверам. Лидер может выйти из строя или отключиться от других серверов, и в этом случае будет избран новый лидер. 
Учитывая подход лидера, Raft разбивает проблему консенсуса на три относительно независимых подзадачи, которые обсуждаются в следующих подразделах:
• Выборы лидера: новый лидер должен быть выбран, когда существующий лидер терпит поражение (раздел 5.2).
• Репликация журналов: лидер должен принимать записи журналов от клиентов и реплицировать их по кластеру, заставляя другие журналы согласовывать свои собственные 
журналы (раздел 5.3).
• Безопасность: ключевым свойством безопасности для Raft является свойство безопасности State Machine на рисунке 3: если какой-либо сервер применил конкретную 
запись журнала к своему конечному автомату, то никакой другой сервер не может применить другую команду для того же индекса журнала. Раздел 5.4 описывает, как 
Raft обеспечивает это свойство; решение предполагает дополнительное ограничение на механизм выборов, описанный в разделе 5.2. 
После представления алгоритма консенсуса в этом разделе обсуждается вопрос доступности и роли времени в системе.

## Задача 2

Создать ваш первый Docker Swarm кластер в Яндекс.Облаке

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker node ls
```

**Ответ:** 
На скриншоте представлены доступные ноды в кластере. Лидером является node02 (после перезагрузки лидера node01)
![docker-node-ls](/05-virt-05-docker-swarm/Lecture/img/docker-node-ls.png)

## Задача 3

Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```

**Ответ:** 
На скриншоте представлены доступные сервисы в кластере. Показано сколько реплик каждого соервиса активно и какой режим репликации включен.
![docker-service-ls](/05-virt-05-docker-swarm/Lecture/img/docker-service-ls.png)

## Задача 4 (*)

Выполнить на лидере Docker Swarm кластера команду (указанную ниже) и дать письменное описание её функционала, что она делает и зачем она нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```
**Ответ:**

![docker-swarm-update](/05-virt-05-docker-swarm/Lecture/img/docker-swarm-update.png)
* Команда ` docker swarm update --autolock=true ` 
