## В поисках понятного алгоритма консенсуса (Расширенная версия)
- Диего Онгаро и Джон Остерхаут Стэндфордский Университет

### Абстрактный
Raft - это согласованный алгоритм управления реплицированным журналом. Он дает результат, эквивалентный (мульти) Paxos, и он так же эффективен, как Paxos, 
но его структура отличается от Paxos; это делает Raft более понятным, чем Paxos, а также обеспечивает лучшую основу для создания практических систем. 
Чтобы повысить понятность, Raft разделяет ключевые элементы консенсуса, такие как выборы лидера, репликация журналов и безопасность, и обеспечивает более 
высокую степень согласованности, чтобы уменьшить количество состояний, которые необходимо учитывать. Результаты пользовательского исследования показывают, 
что студентам легче освоить Raft, чем Paxos. 
Raft также включает новый механизм для изменения членства в кластере, который использует перекрывающееся большинство, чтобы гарантировать безопасность.

### 1. Введение

Алгоритмы консенсуса позволяют совокупности машин работать как связная группа, которая может пережить отказы некоторых из ее членов. Благодаря этому они играют 
ключевую роль в создании надежных крупномасштабных программных систем. Paxos [15, 16] доминировал в обсуждении алгоритмов консенсуса за последнее десятилетие: 
большинство реализаций консенсуса основаны на Paxos или находятся под его влиянием, и Paxos стал основным средством обучения студентов консенсусу. К сожалению, 
Paxos довольно сложно понять, несмотря на многочисленные попытки сделать его более доступным. Кроме того, его архитектура требует сложных изменений для поддержки 
практических систем. В результате и разработчики систем, и студенты испытывают трудности с Paxos. После борьбы с Paxos мы решили найти новый алгоритм консенсуса, 
который мог бы обеспечить лучшую основу для построения системы и обучения. Наш подход был необычен тем, что нашей основной целью была понятность: можем ли мы 
определить алгоритм консенсуса для практических систем и описать его таким образом, чтобы его было легче изучить, чем Paxos? Кроме того, мы хотели, чтобы 
алгоритм облегчил развитие интуиции, необходимой для сборщиков систем. Важно было не только чтобы алгоритм работал, но чтобы было очевидно, почему он работает.


### 2 реплицированных конечных автомата

Алгоритмы консенсуса обычно возникают в контексте реплицированных конечных автоматов [37]. При таком подходе конечные автоматы на совокупности серверов вычисляют 
идентичные копии одного и того же состояния и могут продолжать работать, даже если некоторые из серверов вышли из строя. Реплицированные конечные автоматы 
используются для решения множества проблем отказоустойчивости в распределенных системах. Например, крупномасштабные системы с одним лидером кластера, такие как 
GFS [8], HDFS [38] и RAMCloud [33], обычно используют отдельный реплицированный конечный автомат для управления выборами лидера и хранения информации о 
конфигурации, которая должна выжить. лидер вылетает. Примеры реплицированных конечных автоматов включают Chubby [2] и ZooKeeper [11]. Реплицированные конечные 
автоматы обычно реализуются с использованием реплицированного журнала, как показано на рисунке 1. Каждый сервер хранит журнал, содержащий серию команд, которые 
его конечный автомат выполняет по порядку. Каждый журнал содержит одни и те же команды в одинаковом порядке, поэтому каждый конечный автомат обрабатывает одну и 
ту же последовательность команд. Поскольку конечный автомат детерминирован, каждый вычисляет одно и то же состояние и одну и ту же последовательность выходных 
данных. Поддержание согласованности реплицированного журнала - задача алгоритма консенсуса. Модуль консенсуса на сервере получает команды от клиентов и добавляет 
их в свой журнал. Он взаимодействует с консенсусными модулями на других серверах, чтобы гарантировать, что каждый журнал в конечном итоге будет содержать одни и 
те же запросы в том же порядке, даже если некоторые серверы выйдут из строя. После того, как команды должным образом реплицированы, конечный автомат каждого 
сервера обрабатывает их в порядке журнала, а результаты возвращаются клиентам. В результате кажется, что серверы образуют единый высоконадежный конечный автомат.

Алгоритмы консенсуса для практических систем обычно обладают следующими свойствами:
• Они обеспечивают безопасность (никогда не возвращают неверный результат) во всех не византийских условиях, включая задержки в сети, разделы и потерю пакетов, 
дублирование и изменение порядка.
• Они полностью функциональны (доступны) до тех пор, пока любое большинство серверов работает и может обмениваться данными друг с другом и с клиентами. 
Таким образом, типичный кластер из пяти серверов может выдержать отказ любых двух серверов. Предполагается, что серверы выходят из строя при остановке; 
позже они могут выйти из состояния стабильного хранилища и снова присоединиться к кластеру.
• Они не зависят от времени для обеспечения согласованности журналов: неисправные часы и чрезмерные задержки сообщений могут, в худшем случае, вызвать 
проблемы с доступностью.
• В общем случае команда может быть завершена, как только большая часть кластера ответит на один цикл удаленных вызовов процедур; меньшинство медленных 
серверов не должно влиять на общую производительность системы.

### 3 Что не так с Paxos?
### 4 Дизайн для понятности
### 5 Алгоритм консенсуса Raft

Raft - это алгоритм управления реплицированным журналом в форме, описанной в разделе 2. На рисунке 2 приведен алгоритм в сжатой форме для справки, а на рисунке 3 
перечислены ключевые свойства алгоритма; элементы этих фигур обсуждаются по частям в остальной части этого раздела. Raft реализует консенсус, сначала выбирая 
выдающегося лидера, а затем возлагая на него полную ответственность за управление реплицированным журналом. Лидер принимает записи журнала от клиентов, 
реплицирует их на другие серверы и сообщает серверам, когда можно безопасно применять записи журнала к их конечным машинам. Наличие лидера упрощает управление 
реплицированным журналом. Например, лидер может решить, где разместить новые записи в журнале, не консультируясь с другими серверами, и данные будут передаваться 
простым способом от лидера к другим серверам. Лидер может выйти из строя или отключиться от других серверов, и в этом случае будет избран новый лидер. 
Учитывая подход лидера, Raft разбивает проблему консенсуса на три относительно независимых подзадачи, которые обсуждаются в следующих подразделах:
• Выборы лидера: новый лидер должен быть выбран, когда существующий лидер терпит поражение (раздел 5.2).
• Репликация журналов: лидер должен принимать записи журналов от клиентов и реплицировать их по кластеру, заставляя другие журналы согласовывать свои собственные 
журналы (раздел 5.3).
• Безопасность: ключевым свойством безопасности для Raft является свойство безопасности State Machine на рисунке 3: если какой-либо сервер применил конкретную 
запись журнала к своему конечному автомату, то никакой другой сервер не может применить другую команду для того же индекса журнала. Раздел 5.4 описывает, как 
Raft обеспечивает это свойство; решение предполагает дополнительное ограничение на механизм выборов, описанный в разделе 5.2. 
После представления алгоритма консенсуса в этом разделе обсуждается вопрос доступности и роли времени в системе.

#### 5.1 Основы работы с плотом
#### 5.2 Выборы лидера
#### 5.3 Репликация журнала
#### 5.4 Безопасность
##### 5.4.1 Ограничение выборов
##### 5.4.2 Подтверждение записей из предыдущих условий
##### 5.4.3 Аргумент безопасности
#### 5.5 Сбои соратника и кандидата
#### 5.6 Сроки и доступность
### 6 Изменения в составе кластера
### 7 Уплотнение бревен
### 8 Взаимодействие с клиентами
### 9 Внедрение и оценка
#### 9.1 Понятность
#### 9.2 Правильность
#### 9.3 Производительность
### 10 Связанные работы
### 11 Заключение
### 12 Благодарности
