# "5.1. Основы виртуализации" - Захаров Сергей Николаевич

## Задача 1

Вкратце опишите, как вы поняли - в чем основное отличие паравиртуализации и виртуализации на основе ОС.

   **Ответ:**

Отличия данный типов виртуализации состоит в том, что при паравиртуализации гипервизор не является самостоятельной опреационной системой,
и гостевые ОС используют свои собственные ядра (хоть и модифициролванные гипервизором).
А при виртуализации на основе ОС гостевые системы используют ядро хостовой ОС, что ограничивает разнообразие используемых гостевых ОС.

## Задача 2

Выберите один из вариантов использования организации физических серверов, 
в зависимости от условий использования.

Организация серверов:
- физические сервера
- паравиртуализация
- виртуализация уровня ОС

Условия использования:

- Высоконагруженная база данных, чувствительная к отказу
- Различные Java-приложения
- Windows системы для использования Бухгалтерским отделом 
- Системы, выполняющие высокопроизводительные расчеты на GPU

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

   **Ответ:**

   1. Для высоконагруженной базы данных, чувствительной к отказу, на мой взгляд необходимо использовать
      организацию серверов на основе паравиртуализации. Использование, например, гипервизора KVM с надстройкой Proxmox или XEN (из состава свободного ПО) 
позволит создать отказоустойчивый кластер виртуальных серверов. При отказах какого-либо виртуального сервера можно быстро восстановить его исходную копию,
а рабочую нагрузку при этом возьмут на себя другие сервера кластера.

   2. Для работы различных Java-приложений необходимы веб-сервер и возможность быстрого масштабирования ресурсов при увеличении нагрузки
на приложения. При таких условиях паравиртуализация является лучшей технологией. Можно быстро создать необходимое кол-во экземпляров контейнеров приложений  в различных локациях, а затем также быстро от них избавиться
при снижении нагрузки.

   3. При использования Бухгалтерским отделом Windows системы ожидается небольшая нагрузка на ОС и БД. Но важна репликация для быстрого восстановления БД.
В данной ситуации можно использовать как несколько физических не дорогих сервера, с гипервизором Hyper-V или XEN PV. В случае совсем небольших организаций
где отдел бухгалтерии также небольшой, можно использовать один два физических сервера и VirtualBox в качестве гипервизора.
 и в качестве Linux как хостовую, так и гостевую ОС. Будет надежно, но в то же время недорого в эксплуатации.

   4. Для системы, выполняющей высокопроизводительные расчеты на GPU необходимо иметь прямой доступ к ядру драйвера
видеокарты, поэтому в данном случае лучше всего использовать физические сервера.

## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

   **Ответ:**

    1. Согласно условию - это 100 десктопных операционных систем, в основном Windows и немного Linux для пользовательских задач 
   с возможностью удаленного к ним подключения по RDP. 
   В данных условиях возможно применить кластер из высокопроизводительных физических серверов (необходимое кол-во их подбирается в зависимости от ресурсов каждого сервера).
       * Система управления на основе аппаратной виртуализации VMware ESXi или vSphere. Она обеспечивает:
         - Работу ВМ как Windows, так и Linux. 
         - Возможность балансировки нагрузки,
         - Возможность репликации и создания резервных копий.
   * Подробнее о возможностях системы управления [на сайте VMware](https://configmax.esp.vmware.com/guest?vmwareproduct=NSX%20Data%20Center%20for%20vSphere&release=NSX%20for%20vSphere%206.4.9&categories=17-0,20-0)
    2. Учитывая, что решение требуется именно open source, то 30 серверов также будут на основе свободного ПО, например все ОС будут Linux Server,
   поэтому можно использовать KVM или XEN. XEN производительнее KVM, поэтому, согласно условию, выбираем именно ее.
       * KVM - система паравиртуализации:
         - Является нативной для систем семейства Linux, с низким порогом входа
   для администратора системы. 
         - Позволяет создавать ВМ из образов ISO, но не очень хорошо справляется с высокой нагрузкой.
         - На хостовой машине каждая гостевая система работает ка процесс, что важно для отслеживания источника проблем.
       * XEN - система аппаратной виртуализации или паравиртуализации:
         - Поддерживает несколько гостевых операционных систем: Linux, Windows, NetBSD, FreeBSD.
         - Надежная технология. Хостинговые компании Amazon Web Services, Rackspace используют гипервизор в очень больших масштабах
         - Масштабируемость. Гипервизор может масштабироваться до 4095 центральных процессоров с 16 ТБ ОЗУ. Используя Para Virtualization (PV), гипервизор 
     поддерживает до 512 виртуальных ЦП с 512 ГБ ОЗУ на гостя. Используя аппаратную виртуализацию 
     (HVM), он поддерживает до 128 виртуальных ЦП с 1 ТБ ОЗУ на каждого гостя.
         - Безопасность. Использование многоуровневой защиты. Возможности гипервизора позволяют контролировать критически важные компоненты системы.
         - Гибкость. Гипервизор работает на старом оборудовании с использованием паравиртуализации, на новом оборудовании с использованием HVM или PV на HVM. 
     Пользователи могут выбирать из трех наборов инструментов (XL, XAPI и LIBVIRT), 
     из экосистемы программного обеспечения, дополняющего проект, и выбирать наиболее подходящий вариант операционной системы Linux и Unix для своих нужд. 
     Кроме того, гибкая архитектура проекта позволяет поставщикам создавать продукты и услуги на основе Xen для серверов, 
     облачных, встраиваемых систем, настольных компьютеров.
         - Модульность.  Обеспечивается высокая степень масштабируемости, надежности и безопасности, подходящую даже для больших, критических и чрезвычайно безопасных сред. 
         - Миграция виртуальных машин. Это позволяет реагировать на изменение нагрузки на серверах, защищая рабочие нагрузки.
         - Открытый исходный код. Можно способствовать тому, чтобы необходимые потребности были реализованы. И никогда не придется беспокоиться о том, что действие продукта прекратилось по коммерческим причинам.
         - Подробнее на сайте [проекта XEN](https://xenproject.org/users/why-xen/)
    3. Для виртуализации Windows инфраструктуры (десктопы и сервера) может отлично подойти система управления на основе Hyper-V. 
       * Вот почему:
         * Отдельная версия Hyper-V Server — бесплатная
         * Позволяет виртуализировать сервера на Windows
         * Имеется узел виртуализации удаленных рабочих столов на том же сервере, чтобы сделать личные виртуальные рабочие столы или пулы 
     виртуальных рабочих столов доступными для пользователей
         * Позволяет получить удаленный доступ к рабочим столам по VDI
    4. Для тестирования программных продуктов на различных дистрибутивах Linux лучшим вариантом может стать система управления
      на основе бесплатных KVM или XEN:
         * Низкие затраты на создание тестовой среды. Можно временно использовать сервер низкой или средней производительности даже из состава б/у.
         * Возможность использования контейнеризации приложений на основе Docker
         * Используя Docker и Ansible можно также настроить тестовую среду и мониторинг для оценки производительности и поиска ошибок
   ы работе приложений

## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. 
Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

   **Ответ:**
     
1. Проблемы и недостатки гетерогенной среды виртуализации 
  * высокие расходы на обслуживание, т.к. необходимо привлекать к обслуживанию несколько специалистов, знающих эти разные системы.
  * в случае задействования специалистов широкого профиля, знающих одновременно несколько разных систем управления, то неизбежная
  высокая нагрузка на таких специалистов и высокий риск при отсутствии замены ему в случае нетрудоспособности
  * необходимость содержать большее кол-во физических серверов для работы с разными системами управления
  * удорожание инфраструктуры при условии физического резервирования серверов для хостовых систем
2. Необходимые действия для минимизации этих рисков и проблем
  * в случае привлечения к обслуживанию разных специалистов необходимо дополнительное обучение их для выполнения условий резервирования в случае
высоких нагрузок по обслуживанию в одной из систем, а также для резервирования при нетрудоспособности или отпусках
  * в случае привлечения только одного специалиста, иметь возможность пригласить, например, компанию-аутсорс для работы с системами управления
  * необходимо более тщательно и с запасом определить конфигурацию и кол-во физических серверов, т.к. нагрузка на хостовые сервера может варьироваться в широких пределах
3. Создавать гетерогенную среду или нет?
  * создавать, но только если на это есть веские причины, например:
      * используются различные типы гостевых систем с различными операционными системами семейства Windows и Linux, BSD? Solaris и т.д.
    




   
   _________

